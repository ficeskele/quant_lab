<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç³»çµ±æª¢æŸ¥ - Quantum Particle Lab</title>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
    }

    .container {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
    }

    .check-item {
      display: flex;
      align-items: center;
      padding: 15px;
      margin: 10px 0;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      border-left: 4px solid #ccc;
    }

    .check-item.pass {
      border-left-color: #00ff88;
    }

    .check-item.fail {
      border-left-color: #ff4444;
    }

    .check-item.warn {
      border-left-color: #ffaa00;
    }

    .icon {
      font-size: 24px;
      margin-right: 15px;
      min-width: 30px;
    }

    .label {
      flex: 1;
      font-weight: bold;
    }

    .status {
      padding: 5px 15px;
      border-radius: 4px;
      font-size: 14px;
      font-weight: bold;
    }

    .status.pass {
      background: #00ff88;
      color: #000;
    }

    .status.fail {
      background: #ff4444;
      color: #fff;
    }

    .status.warn {
      background: #ffaa00;
      color: #000;
    }

    .status.checking {
      background: #666;
      color: #fff;
    }

    .summary {
      margin-top: 30px;
      padding: 20px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      text-align: center;
    }

    .summary.ready {
      border: 2px solid #00ff88;
    }

    .summary.not-ready {
      border: 2px solid #ff4444;
    }

    button {
      display: block;
      width: 100%;
      padding: 15px;
      margin-top: 20px;
      font-size: 18px;
      font-weight: bold;
      color: #fff;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    button:hover {
      transform: translateY(-2px);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .details {
      margin-top: 10px;
      font-size: 14px;
      opacity: 0.8;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” ç³»çµ±ç›¸å®¹æ€§æª¢æŸ¥</h1>

    <div id="checks">
      <div class="check-item" id="check-webgl">
        <div class="icon">ğŸ¨</div>
        <div class="label">WebGL æ”¯æ´</div>
        <div class="status checking">æª¢æŸ¥ä¸­...</div>
      </div>

      <div class="check-item" id="check-camera">
        <div class="icon">ğŸ“·</div>
        <div class="label">æ”åƒé ­ API</div>
        <div class="status checking">æª¢æŸ¥ä¸­...</div>
      </div>

      <div class="check-item" id="check-es6">
        <div class="icon">ğŸ“œ</div>
        <div class="label">ES6 æ¨¡çµ„æ”¯æ´</div>
        <div class="status checking">æª¢æŸ¥ä¸­...</div>
      </div>

      <div class="check-item" id="check-performance">
        <div class="icon">âš¡</div>
        <div class="label">ç¡¬é«”åŠ é€Ÿ</div>
        <div class="status checking">æª¢æŸ¥ä¸­...</div>
      </div>

      <div class="check-item" id="check-browser">
        <div class="icon">ğŸŒ</div>
        <div class="label">ç€è¦½å™¨ç‰ˆæœ¬</div>
        <div class="status checking">æª¢æŸ¥ä¸­...</div>
      </div>

      <div class="check-item" id="check-network">
        <div class="icon">ğŸŒ</div>
        <div class="label">ç¶²è·¯é€£ç·š</div>
        <div class="status checking">æª¢æŸ¥ä¸­...</div>
      </div>
    </div>

    <div id="summary" class="summary">
      <h2>â³ æ­£åœ¨æª¢æŸ¥ç³»çµ±...</h2>
      <p>è«‹ç¨å€™...</p>
    </div>

    <button id="start-btn" disabled>å•Ÿå‹•æ‡‰ç”¨</button>
  </div>

  <script>
    const checks = {
      webgl: false,
      camera: false,
      es6: false,
      performance: false,
      browser: false,
      network: false
    };

    function updateCheck(id, pass, message = '') {
      const element = document.getElementById(`check-${id}`);
      const status = element.querySelector('.status');

      element.className = `check-item ${pass ? 'pass' : 'fail'}`;
      status.className = `status ${pass ? 'pass' : 'fail'}`;
      status.textContent = pass ? 'âœ“ é€šé' : 'âœ— å¤±æ•—';

      if (message) {
        const details = document.createElement('div');
        details.className = 'details';
        details.textContent = message;
        element.appendChild(details);
      }

      checks[id] = pass;
      updateSummary();
    }

    function updateSummary() {
      const summary = document.getElementById('summary');
      const startBtn = document.getElementById('start-btn');

      const passCount = Object.values(checks).filter(v => v).length;
      const totalCount = Object.keys(checks).length;

      if (passCount === totalCount) {
        summary.className = 'summary ready';
        summary.innerHTML = '<h2>âœ… ç³»çµ±å·²å°±ç·’ï¼</h2><p>æ‰€æœ‰æª¢æŸ¥é …ç›®éƒ½å·²é€šéï¼Œå¯ä»¥é–‹å§‹ä½¿ç”¨ã€‚</p>';
        startBtn.disabled = false;
      } else if (passCount > 0) {
        summary.className = 'summary not-ready';
        summary.innerHTML = `<h2>âš ï¸ éƒ¨åˆ†æª¢æŸ¥æœªé€šé</h2><p>é€šé ${passCount}/${totalCount} é …æª¢æŸ¥</p>`;
      }
    }

    async function checkWebGL() {
      try {
        const canvas = document.createElement('canvas');
        const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
        updateCheck('webgl', !!gl, gl ? `æ¸²æŸ“å™¨: ${gl.getParameter(gl.RENDERER)}` : '');
      } catch (e) {
        updateCheck('webgl', false, 'ç„¡æ³•å»ºç«‹ WebGL ä¸Šä¸‹æ–‡');
      }
    }

    async function checkCamera() {
      try {
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
          updateCheck('camera', false, 'ç€è¦½å™¨ä¸æ”¯æ´ MediaDevices API');
          return;
        }

        const devices = await navigator.mediaDevices.enumerateDevices();
        const hasCamera = devices.some(d => d.kind === 'videoinput');
        updateCheck('camera', hasCamera, hasCamera ? `æ‰¾åˆ° ${devices.filter(d => d.kind === 'videoinput').length} å€‹æ”åƒé ­` : 'æœªæ‰¾åˆ°æ”åƒé ­');
      } catch (e) {
        updateCheck('camera', false, e.message);
      }
    }

    function checkES6() {
      try {
        eval('"use strict"; class Test {}; const t = () => {}; let x = 1;');
        updateCheck('es6', true, 'æ”¯æ´ ES6+ èªæ³•');
      } catch (e) {
        updateCheck('es6', false, 'ä¸æ”¯æ´ ES6 èªæ³•');
      }
    }

    function checkPerformance() {
      const canvas = document.createElement('canvas');
      const gl = canvas.getContext('webgl');

      if (!gl) {
        updateCheck('performance', false, 'ç„¡æ³•æª¢æŸ¥');
        return;
      }

      const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
      if (debugInfo) {
        const renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
        const hasGPU = !renderer.includes('SwiftShader') && !renderer.includes('Software');
        updateCheck('performance', hasGPU, renderer);
      } else {
        updateCheck('performance', true, 'ç„¡æ³•å–å¾—æ¸²æŸ“å™¨è³‡è¨Š');
      }
    }

    function checkBrowser() {
      const ua = navigator.userAgent;
      let browser = 'Unknown';
      let version = 0;

      if (ua.includes('Chrome')) {
        browser = 'Chrome';
        version = parseInt(ua.match(/Chrome\/(\d+)/)?.[1] || 0);
      } else if (ua.includes('Firefox')) {
        browser = 'Firefox';
        version = parseInt(ua.match(/Firefox\/(\d+)/)?.[1] || 0);
      } else if (ua.includes('Safari') && !ua.includes('Chrome')) {
        browser = 'Safari';
        version = parseInt(ua.match(/Version\/(\d+)/)?.[1] || 0);
      } else if (ua.includes('Edge')) {
        browser = 'Edge';
        version = parseInt(ua.match(/Edge\/(\d+)/)?.[1] || 0);
      }

      const minVersions = { Chrome: 90, Firefox: 88, Safari: 14, Edge: 90 };
      const pass = version >= (minVersions[browser] || 0);

      updateCheck('browser', pass, `${browser} ${version}${pass ? '' : ` (å»ºè­° ${minVersions[browser]}+)`}`);
    }

    async function checkNetwork() {
      try {
        const controller = new AbortController();
        const timeout = setTimeout(() => controller.abort(), 5000);

        const response = await fetch('https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/hands.js', {
          method: 'HEAD',
          signal: controller.signal
        });

        clearTimeout(timeout);
        updateCheck('network', response.ok, 'CDN é€£ç·šæ­£å¸¸');
      } catch (e) {
        updateCheck('network', false, 'ç„¡æ³•é€£æ¥åˆ° CDNï¼ˆMediaPipe å¯èƒ½ç„¡æ³•è¼‰å…¥ï¼‰');
      }
    }

    async function runChecks() {
      await Promise.all([
        checkWebGL(),
        checkCamera(),
        checkES6(),
        checkPerformance(),
        checkBrowser(),
        checkNetwork()
      ]);
    }

    document.getElementById('start-btn').addEventListener('click', () => {
      window.location.href = '/';
    });

    runChecks();
  </script>
</body>
</html>
